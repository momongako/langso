!function(e){"use strict";var t={mapHolder:"",mapOptions:[],mapElement:"",map:{},markers:{},circleMap:{},init:function(e,t){this.mapHolder=e,"object"==typeof google&&void 0!==this.mapHolder&&""!=typeof this.mapHolder&&this.initMap(this.mapHolder,t)},getMapSettings:function(){return{styles:qodefMapsVariables.global.mapStyle,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:qodefMapsVariables.global.mapScrollable,draggable:qodefMapsVariables.global.mapDraggable,streetViewControl:qodefMapsVariables.global.streetViewControl,zoomControl:qodefMapsVariables.global.zoomControl,zoom:parseInt(qodefMapsVariables.global.mapZoom,10),mapTypeControl:qodefMapsVariables.global.mapTypeControl,fullscreenControl:qodefMapsVariables.global.fullscreenControl}},getMapOptions:function(t,a){var o={uniqueId:"",holderId:"",mapHeight:0,addresses:[],addressesLatLng:[],pin:"",selectorIsID:!1,multipleTrigger:!1,geolocation:!1};return(o=e.extend(o,a)).selectorIsID?(o.uniqueId=t[0].id,o.holderId=t[0].id):void 0!==t.data("unique-id")&&!1!==t.data("unique-id")&&(o.uniqueId=t.data("unique-id"),o.holderId="qodef-map-id--"+t.data("unique-id")),void 0!==t.data("height")&&!1!==t.data("height")&&(o.mapHeight=parseInt(t.data("height"),10)),void 0!==qodefMapsVariables.multiple.addresses&&""!==qodefMapsVariables.multiple.addresses?o.addresses=qodefMapsVariables.multiple.addresses:void 0!==t.data("addresses")&&!1!==t.data("addresses")&&(o.addresses=t.data("addresses")),void 0!==t.data("pin")&&!1!==t.data("pin")&&(o.pin=t.data("pin")),o},initMap:function(e,t){this.mapOptions=this.getMapOptions(e,t),this.mapElement=document.getElementById(this.mapOptions.holderId),this.map=new google.maps.Map(this.mapElement,this.getMapSettings()),this.triggerGeolocation(),this.setAddress(),this.setMapHeight()},triggerGeolocation:function(){navigator.geolocation&&this.mapOptions.geolocation&&this.centerMapToGeolocationAddress()},setAddress:function(){for(var t=0;t<this.mapOptions.addresses.length;t++){var a=this.mapOptions.addresses[t];if(""===a)return;if(this.mapOptions.multipleTrigger){var o=a.location;null!=o&&""!==o.latitude&&""!==o.longitude&&this.mapOptions.addressesLatLng.push(e.extend(o,a))}else this.setSingleAddress(a)}this.mapOptions.multipleTrigger&&(this.centerMapMultipleAddresses(this.map,this.mapOptions),this.addMultipleMarkers())},setSingleAddress:function(e){var a=new google.maps.InfoWindow({content:'<div id="content"><div id="siteNotice"></div><div id="bodyContent"><p>'+e+"</p></div></div>"}),o=new google.maps.Geocoder;if("object"==typeof o){var i=this.map,s=this.mapOptions;o.geocode({address:e},(function(o,n){if(n===google.maps.GeocoderStatus.OK&&"object"==typeof o){var r=new google.maps.Marker({map:i,position:o[0].geometry.location,icon:s.pin,title:e.store_title});google.maps.event.addListener(r,"click",(function(){a.open(i,r)}));var d={address:o[0].formatted_address,latitude:o[0].geometry.location.lat(),longitude:o[0].geometry.location.lng()};s.addressesLatLng.push(d),t.centerMapAddress(i,s,o)}}))}},setMapHeight:function(){var e=this.mapOptions;e.mapHeight>0&&""!==this.mapElement&&(this.mapElement.style.height=e.mapHeight+"px")},centerMapAddress:function(e,a,o){1===a.addresses.length?e.setCenter(o[0].geometry.location):this.centerMapMultipleAddresses(e,a),google.maps.event.addDomListener(window,"resize",(function(){t.centerMapAddress(e,a,o)}))},centerMapMultipleAddresses:function(e,t){var a=new google.maps.LatLngBounds,o=t.addressesLatLng;if(t.multipleTrigger&&1===o.length)e.setCenter({lat:parseFloat(o[0].latitude),lng:parseFloat(o[0].longitude)});else if("object"==typeof a&&o.length){for(var i=0;i<o.length;i++)a.extend({lat:parseFloat(o[i].latitude),lng:parseFloat(o[i].longitude)});e.fitBounds(a)}},centerMapToGeolocationAddress:function(e,t,a,o){if(navigator.geolocation){var i=this.map;e&&a.addClass("fa-spinner fa-spin"),navigator.geolocation.getCurrentPosition((function(o){var s={lat:o.coords.latitude,lng:o.coords.longitude};if(e){var n=new google.maps.Geocoder,r="",d="";n.geocode({latLng:s},(function(e,o){if(o===google.maps.GeocoderStatus.OK&&"object"==typeof e){for(var i=e,n=0;n<=i.length;n++){var l=i[n];if("object"==typeof l&&"locality"===l.types[0]){var p=l.address_components;r=p[0].long_name;for(var g=0;g<=p.length;g++)"object"==typeof p[g]&&"country"===p[g].types[0]&&(d=r+","+p[g].long_name)}}"string"==typeof r&&(a.removeClass("fa-spinner fa-spin"),"string"==typeof d?t.val(d):t.val(r),window.qodefGeoLocation.showRangeSlider(s,!0),qodef.body.trigger("kamperen_core_trigger_after_autocomplete_places",[t]))}}))}else i.setCenter(s)}))}},centerMapToForwardAddress:function(e){if("string"==typeof e&&"object"==typeof google){var t=this.map,a=this.getMapSettings();(new google.maps.Geocoder).geocode({address:e},(function(e,o){o===google.maps.GeocoderStatus.OK&&"object"==typeof e[0]&&(t.setZoom(a.zoom),t.setCenter(e[0].geometry.location))}))}},addMultipleMarkers:function(){for(var e=[],t=this.mapOptions.addressesLatLng,a=0;a<t.length;a++){var o={lat:parseFloat(t[a].latitude),lng:parseFloat(t[a].longitude)},i={title:t[a].title,itemId:t[a].itemId,address:t[a].address,featuredImage:t[a].featuredImage,itemUrl:t[a].itemUrl,latLng:o},s=new window.qodefCustomMarker({position:o,map:this.map,templateData:i,markerPin:t[a].markerPin});e.push(s)}this.markers=e,this.initMarkerClusters(),this.initMarkerInfo()},initMarkerClusters:function(){new MarkerClusterer(this.map,this.markers,{minimumClusterSize:2,maxZoom:12,styles:[{width:50,height:60,url:"",textSize:12}]})},initMarkerInfo:function(){var t=this.map;e(document).off("click",".qodef-map-marker").on("click",".qodef-map-marker",(function(){var a=e(this),o=e(".qodef-map-marker-holder"),i=e(".qodef-info-window"),s=a.parent(".qodef-map-marker-holder"),n=s.data("latlng"),r=a.siblings(".qodef-info-window");if(s.hasClass("qodef-active qodef-map-active"))s.removeClass("qodef-active qodef-map-active"),r.fadeOut(0);else if(o.removeClass("qodef-active qodef-map-active"),i.fadeOut(0),s.addClass("qodef-active qodef-map-active"),r.fadeIn(300),n.length&&void 0!==n){var d=n.replace("(","").replace(")","").split(",",2);t.panTo(new google.maps.LatLng(parseFloat(d[0]),parseFloat(d[1])))}}))},setGeoLocationRadius:function(t,a,o){if("object"==typeof t&&"object"==typeof google){var i=this.map,s=this.markers;o&&this.circleMap.setMap(null),this.circleMap=new google.maps.Circle({map:i,center:t,radius:1e3*parseInt(a,10),strokeWeight:0,fillColor:"#fc475f",fillOpacity:.15});var n=this.circleMap,r=[];e.each(s,(function(e,t){n.getBounds().contains(t.latlng)&&r.push(t.templateData.itemId)})),window.qodefGeoLocation.disableItemsOutOfRange(r)}},createAutocompletePlaces:function(t){if("object"==typeof google&&"object"==typeof google.maps.places){new google.maps.places.Autocomplete(t,{types:["(cities)"]}).addListener("place_changed",(function(){e(t).next().show(),window.qodefGeoLocation.reset(),qodef.body.trigger("kamperen_core_trigger_after_autocomplete_places",[t])}))}}};window.qodefGoogleMap=t;var a={holder:"",radius:"",slider:"",init:function(e=""){this.holder=e,this.holder.length&&(this.radius=this.holder.find(".qodef-places-geo-radius"),this.slider=document.getElementById("qodef-range-slider-id"),this.radius.length&&null!==this.slider&&this.createSlider())},createSlider:function(){noUiSlider.create(this.slider,{connect:[!0,!1],start:0,step:1,tooltips:!0,format:{from:function(e){return parseInt(e)},to:function(e){return parseInt(e)}},range:{min:0,max:100}}),this.updateMapRadius()},updateMapRadius:function(){var e=0;this.slider.noUiSlider.on("set",(function(t){var o=a.radius.data("geo-location");"object"==typeof o&&(window.qodefGoogleMap.setGeoLocationRadius(o,t,e>0),e++)}))},reset:function(){null!==this.slider&&this.radius.length&&this.radius.is(":visible")&&(this.setRadiusVisibility("",!1),this.slider.noUiSlider.reset())},showRangeSlider:function(e,t){this.radius.length&&this.setRadiusVisibility(e,t)},setRadiusVisibility:function(e,t){this.radius.data("geo-location",e),t?this.radius.show():this.radius.hide()},disableItemsOutOfRange:function(t){var a=this.holder;if(a.length&&"object"==typeof t){var o,i,s=a.find(".qodef-grid-inner article"),n=a.find(".qodef-grid-inner");a.children(".qodef-out-of-range-holder").length||a.append('<div class="qodef-out-of-range-holder"></div>'),i=(o=a.children(".qodef-out-of-range-holder")).children("article"),(s.length||i.length)&&(s.each((function(){var i=e(this),s=i.data("id");if(void 0!==s&&!1!==s){var r=!1;e.each(t,(function(e,t){if(parseInt(s,10)===t)return r=!0,!0})),r||(i.appendTo(o),a.hasClass("qodef-layout--masonry")&&n.isotope("layout"))}})),i.length&&i.each((function(){var o=e(this),i=o.data("id"),s=!1;e.each(t,(function(e,t){if(parseInt(i,10)===t)return s=!0,!0})),s&&(o.appendTo(n),a.hasClass("qodef-layout--masonry")&&n.isotope("layout"))})))}}};window.qodefGeoLocation=a}(jQuery);